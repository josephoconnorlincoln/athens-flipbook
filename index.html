<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flipbook Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {
      font-family: Arial, sans-serif;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      cursor: none;
    }
    body.show-cursor {cursor: default;}
    .container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0 40px;
      opacity: 0;
      animation: fadeIn 0.8s ease-in forwards;
    }
    @media (max-width: 1024px) {
      .container {
        padding: 0 20px;
      }
    }
    @media (max-width: 768px) {
      .container {
        padding: 0 5px;
      }
      body {
        cursor: default;
      }
    }
    @keyframes fadeIn {to {opacity: 1;}}
    #flipbook {
      margin: 0 auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.8), 0 0 100px rgba(0,0,0,0.4);
      border-radius: 4px;
      overflow: visible;
      position: relative;
    }
    #flipbook .page {
      background: #faf8f5;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      border: 1px solid #333;
      border-radius: 3px;
      position: relative;
      box-shadow: inset 0 0 30px rgba(0,0,0,0.05);
    }
    #flipbook .page::after {
      content: '';
      position: absolute;
      inset: 0;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter><rect width="100" height="100" filter="url(%23noise)" opacity="0.03"/></svg>');
      pointer-events: none;
      opacity: 0.4;
    }
    #flipbook .page::before {
      content: '';
      position: absolute;
      width: 40px;
      height: 100%;
      background: linear-gradient(to right, rgba(0,0,0,0.25), rgba(0,0,0,0.08) 50%, transparent);
      left: 0;
      top: 0;
      z-index: 1;
      pointer-events: none;
    }
    #flipbook .page:first-child::before {display:none;}
    #flipbook .page img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: translateZ(0);
      backface-visibility: hidden;
    }
    .loading {text-align:center;color:white;font-size:18px;padding:40px;}
    .loading-progress {margin-top:20px;font-size:24px;font-weight:bold;}
    .loading-bar {width:300px;height:4px;background:rgba(255,255,255,0.2);margin:20px auto;border-radius:2px;overflow:hidden;}
    .loading-bar-fill {height:100%;background:white;width:0%;transition:width 0.3s;}
    .fullscreen-btn {
      position: fixed;
      top: 20px;right: 20px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s;
      z-index: 1000;
      opacity: 0;
    }
    .fullscreen-btn:hover {background: rgba(255,255,255,0.2);transform: scale(1.05);}
    .fullscreen-btn.visible {opacity: 1;}
    .fullscreen-btn .icon {font-size:18px;}
    @media (max-width: 768px) {
      .fullscreen-btn {
        padding: 10px 16px;
        font-size: 12px;
        top: 10px;
        right: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="loading" id="loading">
      <div>Loading flipbook...</div>
      <div class="loading-progress" id="loadingProgress">0%</div>
      <div class="loading-bar">
        <div class="loading-bar-fill" id="loadingBar"></div>
      </div>
    </div>
    <div id="flipbook" style="display:none;"></div>
  </div>

  <button class="fullscreen-btn" id="fullscreenBtn" title="Toggle Fullscreen">
    <span class="icon">â›¶</span><span>Fullscreen</span>
  </button>

  <script>
    const totalPages = 132;
    let hideControlsTimeout;

    function getPageFilename(pageNum) {
      return pageNum === 1 ? 'page__.jpg' : `page__${pageNum}.jpg`;
    }

    function handleMouseMove() {
      $('body').addClass('show-cursor');
      $('.fullscreen-btn').addClass('visible');
      clearTimeout(hideControlsTimeout);
      hideControlsTimeout = setTimeout(() => {
        $('body').removeClass('show-cursor');
        $('.fullscreen-btn').removeClass('visible');
      }, 3000);
    }

    function initFlipbook() {
      const flipbook = $('#flipbook');
      let loadedCount = 0;

      const ratio = 22 / 17;
      const isMobile = window.innerWidth <= 768;
      const isTablet = window.innerWidth <= 1024 && window.innerWidth > 768;
      const isLandscape = window.innerWidth > window.innerHeight;
      
      // Adjust padding based on device and orientation
      let sidePadding = 80; // desktop default (40px each side)
      let topBottomPadding = 10;
      
      if (isMobile) {
        if (isLandscape) {
          sidePadding = 10; // Very minimal in landscape
          topBottomPadding = 5;
        } else {
          sidePadding = 10; // Portrait
          topBottomPadding = 10;
        }
      } else if (isTablet) {
        sidePadding = 40;
        topBottomPadding = 10;
      }
      
      const screenWidth = window.innerWidth - sidePadding;
      const screenHeight = window.innerHeight - topBottomPadding;
      let flipbookWidth, flipbookHeight;

      // Calculate for double page spread - use whichever dimension is limiting
      const widthBasedHeight = screenWidth / (ratio * 2);
      const heightBasedWidth = screenHeight * (ratio * 2);
      
      if (widthBasedHeight <= screenHeight) {
        // Width is the limiting factor
        flipbookWidth = screenWidth;
        flipbookHeight = widthBasedHeight;
      } else {
        // Height is the limiting factor
        flipbookHeight = screenHeight;
        flipbookWidth = heightBasedWidth;
      }

      function updateProgress() {
        loadedCount++;
        const percent = Math.round((loadedCount / totalPages) * 100);
        $('#loadingProgress').text(`${percent}%`);
        $('#loadingBar').css('width', percent + '%');

        if (loadedCount === totalPages) {
          setTimeout(() => {
            $('#loading').hide();
            flipbook.show();
          }, 300);
        }
      }

      for (let i = 1; i <= totalPages; i++) {
        const filename = getPageFilename(i);
        const img = new Image();
        img.onload = updateProgress;
        img.onerror = updateProgress;
        img.src = filename;
        flipbook.append(`<div class="page"><img src="${filename}" alt="Page ${i}"></div>`);
      }

      flipbook.turn({
        width: flipbookWidth,
        height: flipbookHeight,
        autoCenter: true,
        acceleration: true,
        gradients: true,
        elevation: 50,
        duration: 1200
      });
    }

    function nextPage(){ $('#flipbook').turn('next'); }
    function prevPage(){ $('#flipbook').turn('previous'); }

    function toggleFullscreen(){
      if (!document.fullscreenElement) document.documentElement.requestFullscreen();
      else document.exitFullscreen();
    }

    $('#fullscreenBtn').click(toggleFullscreen);

    $(document).keydown(function(e){
      if (e.keyCode === 37){e.preventDefault();prevPage();}
      if (e.keyCode === 39){e.preventDefault();nextPage();}
      if (e.keyCode === 36){e.preventDefault();$('#flipbook').turn('page',1);}
      if (e.keyCode === 35){e.preventDefault();$('#flipbook').turn('page',totalPages);}
      if (e.keyCode === 122){e.preventDefault();toggleFullscreen();}
    });

    $(document).mousemove(handleMouseMove);

    let touchStartX = 0;
    $(document).on('touchstart', e => touchStartX = e.touches[0].clientX);
    $(document).on('touchend', e => {
      const diff = touchStartX - e.changedTouches[0].clientX;
      if (Math.abs(diff) > 50) diff > 0 ? nextPage() : prevPage();
    });

    $(document).ready(() => {initFlipbook();handleMouseMove();});
  </script>
</body>
</html>